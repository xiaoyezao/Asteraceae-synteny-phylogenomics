# Asteraceae-synteny-phylogenomics
<img width="743" alt="Screenshot 2025-01-14 at 21 41 59" src="https://github.com/user-attachments/assets/b35bc922-0a56-41d3-b7f3-d93d1c773560" />

## Introduction
__A pipeline for Asteraceae synteny-phylogenomic analysis__
>
The objective of this pipeline is to apply the synteny-phylogenomic framework built in our [paper](https://www.biorxiv.org/content/10.1101/2025.01.08.631874v1) to study Asteraceae genome evolution in context of ancient genome triplication.
>
1. we use Genespace or Mcscan to map genomes onto the 15*3 Asteraceae Genome Blocks (AGB) that generated based on the comparasion of an diploid outgroup and the paleohexaploid ingroup, from which we obtained syntenic genes as anchors
2. we use the anchors and drimm-synteny to scan the genomes to identify syntenic segments
3. with the synteny segments recovered, we can represent any Asteraceae genomes using the 15*3 AGB system
4. we can characterize the genome rearrangements from AGBs to focal Asteraceae genomes, and any other genome pairs as well
5. we can quantify the gene fractionation in subgenomes 

## Installation and Dependencies
### The pipeline is designed in Python3, and organised in [Jupyter Notebook](https://jupyter.org/). We have only tested it on Mac and Linux, but if all dependencies are available it should also work on Windows.
```sh
# download the package to your desired folder
git clone https://github.com/xiaoyezao/Asteraceae-synteny-phylogenomics
```
### In addition, several other softwares are needed

[__Genespace__](https://github.com/xiaoyezao/GENESPACE)
```sh
# I recommend making a new environment and install all softwares and library dependencies in the same Conda environment.
conda create -n AGB
conda activate AGB

conda install -c bioconda orthofinder=2.5.5
conda install -c bioconda mcscanx

conda install r-data.table r-dbscan r-R.utils r-devtools r-igraph r-mass
conda install -c bioconda bioconductor-Biostrings bioconductor-rtracklayer

devtools::install_github("xiaoyezao/GENESPACE", upgrade = F)
# if any R dependencies are still missing, try to install from Conda
```
>
__DRIMM-Synteny__ (a pre-built executable is available in the software folder)
   ```sh
   # install mono if you don't have it on your computer
   conda install mono -c conda-forge
   # test DRIMM-Synteny
   mono DRIMM-Synteny.exe [arguements]
   
   #if this doesn't work, compile your own DRIMM-Synteny from DRIMM-Synteny.cs (available in the software folder)
   mcs DRIMM-Synteny.cs -out:DRIMM-Synteny
   # test
   mono DRIMM-Synteny --help
   ```
__[ipykernel](https://github.com/ipython/ipykernel) and python libraries__
```sh
# to be able to run the pipeline in Jupyter Notebook, ipykernel is needed
conda install conda-forge::ipykernel

# several python libraries are also needed
conda install conda-forge::pandas
```
## Usage
#### 1. Input
Prepare the genome data in your working directory, e.g.,`workingDirectory`:
```sh
/workingDirectory
└─ meta.txt
└─ peptide
    └─ genome1.fa
    └─ genome2.fa
└─ bed
    └─ genome1.bed
    └─ genome2.bed
└─ index
    └─ genome1.index
    └─ genome2.index

```
1) [BED](https://learn.gencore.bio.nyu.edu/ngs-file-formats/bed-format/#:~:text=BED%20format%20is%20a%20simple,as%20graphical%20represntations%20of%20features.) formatted coordinates of each gene (chr, start, end, name), only the first four columns.
__I highly recommend to remove alternative splices by retaining only the longest one__
3) Peptide sequences in fasta format. Make sure the header (name of gene) exactly matches the gene name in BED (4th column).
4) Index of the genome assemblies generated by e.g., [`samtools faidx`](https://learn.gencore.bio.nyu.edu/ngs-file-formats/bed-format/#:~:text=BED%20format%20is%20a%20simple,as%20graphical%20represntations%20of%20features.). The chromosome names exactly match the name in BED (1st column).
#### 2. Run the pipeline.
Please refer to the `Asteraceae synteny-phylogenomics.ipynb` to run the pipeline step by step.
1) we will use orthofinder and genespace to infer [hierarchical orthogroups](https://lab.dessimoz.org/blog/2016/12/08/what-hogs-are) and anchor genes which will be used for synteny segment reconstruction in next step. 


#### 3. Run the pipeline
The whole pipeline is organsed in several steps in jupty notebook. This requires that you have some knowledge of Python programming, however, this gives you a lot of freedom to modify the process as you like.


## Output
#### 1. process synOG
1) read in synOG table and adjust name
#### 2. perform drimm-synteny to call synteny blocks
1) process synOG table, call pairwise orthologs for given ref-target pair
2) DRIMM-Synteny was designed to handle complex genomes [23], for example genomes with duplications followed by diploidization. In the case of the comparison of S. taccada and Asteraceae diploid genomes, single, duplicated and triplicated synteny blocks in Asteraceae diploid genomes were reconstructed. For further analysis, the triplicated blocks (>= 5 anchor genes) that are presumably derived from the ancient Asteraceae genome triplication were used. ![image](https://github.com/user-attachments/assets/7762b1ab-490b-4ae0-889a-bb08a57829b7)

#### 3. process drimm raw blocks using processDrimm()
from drimm-synteny, we get raw blocks, and we need to clean and sort the raw blcoks to
1) split the all-in-one blocks (drimm-synteny output) into individual genomes
2) meanwhile divide the blocks into separate ones based on ratio (normally from genome duplication, but segmental duplications cannot be distinguished, and are also processed)
#### 4. with the results from step 3 (the final blocks), we can do:
1) ancestral genome reconstruction (multi-genome analysis)
   >a. with the outputs from step3, we can do ancestral chromosome reconstruction using IAGS
   >
   >b. different scenarios need to be considered based on the genome evolution history (duplication), and outgroup is very important
2) chracterize genome rearrangements, there are two approaches:
   >a. iags (fission, fusion), please follow iags guide; the output from step 3 can be used directly
   >
   >b. Grimm approach (fission, fusion, inversion, translocation)

## TODOs

## Citation
